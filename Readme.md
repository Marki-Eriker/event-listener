# Система обработки событий

- Сервис слушает события от агентов, которые представляют собой поток line-delimited JSON структур.
- Поле `message` шифруется перед записью в базу данных
- Сервис предоставляет HTTP API для просмотра событий и управления пользователями

Структура положительного ответа `/v1/event/list`

```json
{
  "paginator": {
    "total_items": 10,
    "total_pages": 5,
    "page": 5,
    "items_per_page": 2,
    "has_next_page": false,
    "has_previous_page": true
  },
  "events": [
    {
      "id": "3496e22b-9fe1-424b-b308-e587ad873eaf",
      "event_id": 5,
      "created": "2023-01-15T16:53:10.283928Z",
      "system_name": "system_1",
      "message": "encoded data",
      "incident": false
    }
  ]
}
```

| Путь запроса                              | Описание                                                                                                                                                                                                                                                                                                                                                             | Входные параметры                                                 | Возвращаемое значение                                         |
|-------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------|---------------------------------------------------------------|
| POST <br/>`/v1/auth/login`                | Сгенерирует токен для запросов требующих авторизации. <br/> <br/>Не подтвержденный администратором пользователь не получит токен                                                                                                                                                                                                                                     | login: string<br/> password: string                               | HTTP 200 <br/>{ token: string }<br/>HTTP 400<br/>HTTP 500     |
| POST <br/>`/v1/auth/register`             | Регистрация нового пользователя.<br/> <br/> Существующие роли:<br/> Администратор (100) и Аналитик (200)                                                                                                                                                                                                                                                             | login: string<br/> password: string<br/> role: int                | HTTP 201<br/>HTTP 400<br/>HTTP 500                            |
| PATCH <br/>`/v1/user/verify/{id}`         | Подтвердит регистрацию пользователя. Доступно только с ролью Администратора                                                                                                                                                                                                                                                                                          | id - uint                                                         | HTTP 201<br/>HTTP 400<br/> HTTP 401<br/>HTTP 403<br/>HTTP 500 |
| GET <br/>`/v1/event/list`                 | Вернет список сохраненных событий. Администратор не получает секретных данных. Аналитик получает полные данные<br/> <br/>Поддерживает постраничный вывод с указанием размера страницы. <br/> <br/>Порядок вывода ASC или DESС. <br/> <br/>Поле сортировки, по умолчанию по created, возможно по id и event_id.<br/> <br/>Фильтрация событий по конкретному system_name | query: <br/>page<br/>page_size<br/>order<br/>order_field<br/>system_name | HTTP 200 <br/> HTTP 401<br/>HTTP 500                          |
| PATCH <br/>`/v1/event/list/incident/{id}` | Отметит событие как инцидент. Доступно только с ролью Аналитик                                                                                                                                                                                                                                                                                                       | id - валидный UUID                                                | HTTP 200<br/> HTTP 401<br/> HTTP 403<br/>HTTP 500             |

## Запуск

Выполнив `docker-compose up` Запустится сервис и база данных, база данных наполнится тестовыми данными.

Пользователи (логин/пароль)
- admin/password - Подтвержденный Администратор
- analyst/password - Подтвержденный Аналитик
- analyst2/password - Не подтвержденный Аналитик


